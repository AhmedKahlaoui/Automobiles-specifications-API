services:
  api:
    build: .
    container_name: automobile-specs-api
    ports:
      - "5000:5000"
    environment:
      # App config
      FLASK_ENV: production
      # Persist SQLite under /app/instance (mounted from host)
      DATABASE_URL: sqlite:////app/instance/cars.db
      # Helps Swagger UI generate the right host
      SWAGGER_HOST: localhost:5000
      # Optional initial admin creation (uncomment and set values)
      # ADMIN_USER: admin
      # ADMIN_PASSWORD: secret
    volumes:
      - ./instance:/app/instance

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: automobile-specs-frontend
    ports:
      - "5173:5173"
    environment:
      # The browser runs on your host machine, so point to the host-mapped API port.
      VITE_API_BASE_URL: http://127.0.0.1:5000/api/v1
      # Reliable file watching on Windows + Docker bind mounts
      CHOKIDAR_USEPOLLING: "true"
    volumes:
      - ./frontend:/app
      - /app/node_modules
